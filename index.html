!<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Meschede 2019</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
</head>
<body>


    <iframe id="rpg-spinne" src="./rpg-final/game.html?spider"></iframe>
    <iframe id="rpg-gorilla" src="./rpg-final/game.html"></iframe>
    <iframe id="pac-mensch" src="./pac/game.html"></iframe>
    <iframe id="platformer-rino" src="./platformer-final/game.html"></iframe>
    <iframe id="platformer-spinne" src="./platformer-final/game.html?spider"></iframe>
    <iframe id="twine" src="./twine/zoo.html"></iframe>

    
    <!--<audio src="./sound/music/Bossfight.wav" loop></audio>-->


    <div id="backToTwine">x</div>

    <script>

        const looper = (filename, lengthInMs)=>{
            let running = false;
            let current_player = "a";
            const player_a = document.createElement("audio");
            const player_b = document.createElement("audio");

            player_a.src = filename;
            player_b.src = filename;

            const loopIt = ()=>{
                if(!running)
                    return;
                var player = null;

                if(current_player == "a"){
                    player = player_b;
                    current_player = "b";
                }
                else{
                    player = player_a;
                    current_player = "a";
                }

               player.play();
               setTimeout(loopIt, lengthInMs); 
            }

            const stop = ()=>{
                running = false;
                player_a.pause();
                player_b.pause();
            }

            const start = ()=>{
                running = true;
                loopIt();
            }

            const isLooaded = ()=>{

            }


            return {
                start,
                stop
            };


        }


        


        const hideAll = ()=>{
            [...document.querySelectorAll("iframe")].forEach((frame)=>{
                frame.style.display = 'none';
            })   
        };


        const showFrame = (name)=>{
            hideAll();
            document.querySelector(`#${name}`).style.display = 'block';
        };



        window.addEventListener("message", (event)=>{
            const command = event.data.command;
            ({
                hideAll: ()=>{hideAll();},
                showRPGSpinne: ()=>{
                    showFrame("rpg-spinne");
                    playMusic("twineB");
                },
                showRPGGorilla: ()=>{
                    showFrame("rpg-gorilla");
                     playMusic("bossfight");
                },
                showPacMensch: ()=>{
                    showFrame("pac-mensch");
                    playMusic("pacB");
                },
                showPlatformRino: ()=>{
                    showFrame("platformer-rino");
                    playMusic("jumpAndRunC");
                 },
                showPlatformSpinne: ()=>{
                    showFrame("platformer-spinne");
                    playMusic("jumpAndRunA"); 
                },
                showTwine: ()=>{
                    showFrame("twine");
                    playMusic("twineA");
                },
                playMusic: ()=>{playMusic(event.data.song);}
            }[command] || (()=>{
                console.log("unknow command received", event.data);
            }))();
        });

        document.querySelector("#backToTwine").addEventListener("click", ()=>{
            console.log("click");
            window.postMessage({command: "showTwine"}, "*");
        })

setTimeout(
    ()=>{
 window.postMessage({command: "showTwine"}, "*");
    }, 5000
);
       

        const songs = {
            bossfight : looper("./sound/music/Bossfight.wav", 4000),
            gameover : looper("./sound/music/GameOver.wav", 4000),
            jumpAndRunA : looper("./sound/music/JumNunv2.1.wav", 3450),
            jumpAndRunB : looper("./sound/music/JumpNrunv1.wav", 3450),
            jumpAndRunC : looper("./sound/music/JumpNrunv2.wav", 3450),
            pacA : looper("./sound/music/Pac-manv1.wav", 4000),
            pacB : looper("./sound/music/pac-manv2.wav", 4000),
            toteTiere : looper("./sound/music/toteTiere.wav", 4000),
            twineA : looper("./sound/music/Twinev2.wav", 4000),
            twineB : looper("./sound/music/Twinev3.wav", 4700),
            twineC : looper("./sound/music/title.wav", 40000)
        }

        const stopAllMusic = ()=>{
            Object.values(songs).forEach((song)=>{
                song.stop();
            });
        };

        const playMusic = (name)=>{
            stopAllMusic();
            const song=songs[name];
            if(song){
                song.start();
            }
        };
        
    </script>
    
</body>
</html>