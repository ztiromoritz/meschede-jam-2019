pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
frame=0
croc = {}
croc.x = 1*8
croc.x1 = 0
croc.x2 = 7
croc.y = 1*8
croc.y1 = 3
croc.y2 = 6

pl = {}
pl.x = 1*8
pl.y = 5*8
pl.x1=3
pl.x2=5
pl.y1=3
pl.y2=6

door= {}
door.x=15*8
door.y=14*8
door.x1=0
door.x2=7
door.y1=0
door.y2=7

special={}
special.x=3*8
special.y=1*8
special.x1=0
special.x2=7
special.y1=0
special.y2=7


keys={}
 add(keys,create(13*8,1*8))
 add(keys,create(5*8,3*8))
 add(keys,create(5*8,6*8))
 add(keys,create(14*8,5*8))
 add(keys,create(1*8,10*8))
 add(keys,create(10*8,12*8))
 add(keys,create(1*8,14*8))
 add(keys,create(8*8,14*8))
 

go_frame=64
win_frame=144

door_frame=80

gameover=false
win=false

end

function create(x,y)
 local key={}
  key.x=x
  key.y=y
  
  key.x1=0
  key.y1=0
  key.x2=7
  key.y2=7
  
  return key
  
end 

function _draw()
cls() 
map(0,0,0,0,16,16)
 
spr(door_frame,door.x,door.y)
if win then
 zspr(win_frame,1,1,37,68,6)
 if frame %6<3 then
 print("win",60,60,12)
 end 
 
  
elseif gameover then
 spr(go_frame,pl.x,pl.y)
  if frame %6<3 then
 print("game over",45,60,8)
 end 
  else
   if (frame%6<3) then
  	spr(1,pl.x,pl.y)
  else
  	spr(2,pl.x,pl.y)
  end
  if (frame%6<3) then
  	spr(3,croc.x, croc.y)
  else
  	spr(4,croc.x, croc.y)
  end
 
end
   
if false then
--if(frame%2==0) then
 pset(pl.x+pl.x1, pl.y+pl.y1,12)
 pset(pl.x+pl.x1, pl.y+pl.y2,12)
 pset(pl.x+pl.x2, pl.y+pl.y1,12)
 pset(pl.x+pl.x2, pl.y+pl.y2,12)
end

--(flag,0,0,3)

for k in all(keys) do
 spr (96,k.x,k.y)
end


end


function update_croc()
	s=0.4
	if (pl.x-croc.x) <0 then
	croc.x=croc.x-s else
	croc.x=croc.x+s
	end
	
	if (pl.y-croc.y) <0 then
	croc.y=croc.y-s else
	croc.y=croc.y+s

 end	


 
end -- update_croc


function update_player()
 for k in all (keys) do 
 if collide(k,pl) then
 del(keys,k)
 end
end
if #keys==0 then
  update_door()
 end
 if btn (1) then 
  map_x = (pl.x+pl.x2+1)/8
  map_ya = (pl.y+pl.y1)/8
  map_yb = (pl.y+pl.y2)/8
  tilea = mget(map_x,map_ya)
  tileb = mget(map_x,map_yb)
  flaga= fget(tilea)
  flagb= fget(tileb)
  if not (
       flaga == 2 
  		or flagb == 2) then
   pl.x=pl.x+1 
  end 
 end
 
 
 if btn (2) then
 map_xa = (pl.x+pl.x1)/8
 map_xb = (pl.x+pl.x2)/8
 map_y = (pl.y+pl.y1-1)/8
 tilea = mget(map_xa,map_y)
 tileb = mget(map_xb,map_y)
 flaga= fget(tilea)
 flagb= fget(tileb)
 if not (
      flaga == 2 
   or flagb == 2) then
  pl.y=pl.y-1
 end 
 end  
 if btn (⬅️) then
  map_x = (pl.x+pl.x1-1)/8
  map_ya = (pl.y+pl.y1)/8
  map_yb = (pl.y+pl.y2)/8
  tilea = mget(map_x,map_ya)
  tileb = mget(map_x,map_yb)
  flaga= fget(tilea)
  flagb= fget(tileb)
  if not (
      flaga == 2
   or flagb == 2) then
   pl.x=pl.x-1 
  end
 end 
 if btn (3) then
 map_xa = (pl.x+pl.x1)/8
 map_xb = (pl.x+pl.x2)/8
 map_y = (pl.y+pl.y2+1)/8
 tilea = mget(map_xa,map_y)
 tileb = mget(map_xb,map_y)
 flaga= fget(tilea)
 flagb= fget(tileb)
 if not (
 					flaga == 2
 		or	flagb == 2) then
  pl.y=pl.y+1 
 end
end
end


function update_gameover()
 go_frame=go_frame+0.25
 if go_frame==80 then 
 _init()
 end
end

function update_win()
	 if	win_frame<148 then
	 win_frame=win_frame+0.1  
  end
end

function update_door()
 if door_frame<82 then
 door_frame=door_frame+0.1
 else door_frame=82+(frame%2)
 end
 
end

function zspr(n,w,h,dx,dy,dz)
 n=flr(n)
  sx = 8 * (n % 16)
  sy = 8 * flr(n / 16)
  sw = 8 * w
  sh = 8 * h
  dw = sw * dz
  dh = sh * dz

  sspr(sx,sy,sw,sh, dx,dy,dw,dh)
end

function _update()
 frame=frame+1 
 if gameover then 
 	update_gameover()
 elseif win then
 	update_win()
 else
	update_croc()
 	update_player()
 
 end
 

	if collide(pl,croc)then
	gameover=true 
	end
	
	if collide(pl,door) and 
	#keys==0 then
	win=true
	end

end 

function collide(obj,other)
 if other.x+other.x2 >
obj.x+obj.x1 and
 other.y+other.y2 >
obj.y+obj.y1 and
 other.x+other.x1 <
obj.x+obj.x2 and
 other.y+other.y1 <
obj.y+obj.y2 then
  return true 
 end 
  
end


-->8
-- pathfinding
__gfx__
00000000000000000000000000000000000000000006660000000000022222200222222000000000000000000000000000000000f22222200222222002222220
00000000000000000000000000000000000000000006060000000000022222222222222022222220022222220222222022222222722222222222222001111112
0070070000b04000000040b0b00003bbb00003000006660000000000022222222222222022222220022222220222222022222222f22222222222222001111112
00077000000b0bb000bb0b000bbbbb000bbbbbbb0566000000000000022222222222222022222220022222220222222022222222f22222222222222001111112
000770000000b0000000b000003bbbbb00bbb3bb0666000000000000022222222222222022222220022222220222222022222222f22222222222222001111112
00700700000010000000100000303300033003000006000000000000022222222222222022222220022222220222222022222222722222222222222001111112
00000000000101000001010000000000000000000000000000000000022222222222222022222220022222220222222022222222f22222222222222001111112
00000000000001000001000000000000000000000000000000000000000000000000000000000000000000000222222002222220f22222200000000010000000
000000000000000061616161ffffffff000000000222222222222220222222200000000022222222022222220000000000000000222222200222222022222222
000000000000000065656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
00000000b00003bb65656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
000000000bbbbb8065656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
00000000003bbbbb65656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
000000000030338065656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
000100000000008065656565ffffffff011111100222222222222220222222202222222222222222022222222222222002222222222222222222222222222222
088888888888888865656565ffffffff000000000222222222222220000000002222222200000000000000002222222002222222222222202222222202222220
022222220222222002222220000000000222222022222222222222220222222222222220f2222220f7fff7ff2222222f02222220022222200000000000000000
22222222222222200222222222222222222222222222222222222222222222222222222272222220222222222222222702222220022222202222222200007777
222222222222222002222222222222222222222222222222222222222222222222222222f2222220222222222222222f02222220022222202222222200007777
222222222222222002222222222222222222222222222222222222222222222222222222f2222220222222222222222f02222220022222202222222200007777
222222222222222002222222222222222222222222222222222222222222222222222222f222222022222222222222270222222002222220222222220000e777
22222222222222200222222222222222222222222222222222222222222222222222222272222220222222222222222f0222222002222220222222220000e777
222222222222222002222222222222222222222222222222222222222222222222222222f2222220222222222222222f02222220022222202222222200007777
022222220222222002222220022222200000000022222220022222222222222222222222f2222220000000002222222f02222220000000000000000000007777
00000000ffffffff88888888f2222220f2222222f7fffff7222222266161616162222220111111118111e111888888e888888888888888e8e811111111e11111
000000007777ff6f8888e8e82222222072222222fff7ffff2222222f656565656222222011111111811e1f118e88e888888e88888e88e888811111111f1e1111
000000007777fff68888888822222220f2222222fffff7ff2222222f656565656222222011111111111e11118888888888ee8e888888888888811111111e1111
000000007777ffff8888888822222220f22222227f6fffff2222222f6565656562222220111111111111e11188888e888888888e88888e888111111111e1111e
00000000777effffee88888e22222220f2222222ffffff6f22222227656565656222222011111111eeeee11111e818888888888811e81888e881111111eeeee1
000000007777f6ffe11888112222222072222222f7fff7ff2222222f6500006562222220111111111eee1111111118118e8888881111181118e11111111eee11
000000007777ffff111e811122222220f2222222ffffffff2222222f650ff0656222222011111111111e11111e18811188e888881e188111881111111111e111
000000007777fff61111111102222220f22222200000000022222220650ff0656222222011111111188e881111811111888e88888888888818111111e888e888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b04000000040b00000400000000000000000000000000000000000000000000000000000000000b00003bbb00003bbb00003bbb00003bbb00003bbb00003bb
000b0bb000bb0b0000bb0b0000bb0b0000bb0000000b0000000000000000000000000000000000000bbbbb800bbbbbbb0bbbbb000bbbbbbb0bbbbb000bbbbbbb
0000b0000000b0000000b0000000b0000000b0000000b0000000b000000000000000000000000000003bb3bb003bb380003bb3bb003bb300003bb3bb003bb300
00001000000010000000100000001000000010000000100000001000000010000000100000000000003033800030338000303380003033800030330000303300
00010100000101000001010000010100000101000001010000010100000101000001000000010000000000800000008000000080000000800000008000000000
00000100000100000001008000010088000108880001888800018888000888880088888808888888888888888888888888888888888888888888888888888888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000777700000000333003b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000b77700000000300000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000b7770000000033b0b3bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000b77700000000300b03b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077770000000033b0b3bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066600000666000006c6000006c6000006c6000006cc000006cc000006cc00000ccc00000ccc00000ccc000000000000000000000000000000000000000000
00060600000606000006060000060600000c0600000c0600000c0c00000c0c00000c0c00000c0c00000c0c00000c0c00000ccc0007cc00000ccc0000000c0000
00066600000666000006660000066c0000066c0000066c00000c6c00000ccc00000ccc00000ccc00000ccc00000ccc0007cc00000ccc0000000c000000000000
0566000006660000066600000c6600000c6c00000c6c00000c6c00000ccc00000ccc00000ccc000007cc000007cc00000ccc0000000c00000000000000000000
066600000666000006660000066600000666000006c6000006c6000006c600000cc600000ccc00000ccc00000ccc0000000c0000000000000000000000000000
0006000000060000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000dd000000dd000000d7000000d7000000d7000000d7000000d7000000770000000000000000000000000000000000000000000000000000000000000000
000000dd000000dd000000dd000000dd0000007d0000007700000077000000770000007700000000000000000000000000000000000000000000000000000000
00000dd0000007d0000007d0000007d0000007d0000007d000000770000007700000077000000770000000000000000000000000000000000000000000000000
000000d0000000d0000000d000000070000000700000007000000070000000700000007000000070000000700000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1222222012222222fffffff76ffff7ff00000000f222222022222222000000011000000000000000011111112222222211111111000000000000000022222222
1222222012222222fff7ffffffffffff22222220f222222222222222011111100111111001111110011111112222222211111111011111110222222222222222
1222222012222222ffffff7ffffff6ff22222220f2222222222222220111111001111110011111100111111122222222111111ee011111110222222222222222
1222222012222222ff7fffffffffffff22222220f2222222222222220111111001111110011111100111111122222222111111ef011111110222222222222222
1222222012222222fff7fffffff6ffff22222220f222222222222222011111100111111001111110011111112222222211111ee1011111110222222222222222
1222222012222222ffffffffffffffff22222220f2222222222222220111111001111110011111100111111122222222111118e8011111110222222222222222
1222222012222222fffff7fffff7ffff22222220f222222222222222011111100111111001111110011111112222222211188888011111110222222222222222
1222222012222220f7ffffffffffffff00000000f222222022222222000000000000000000000001000000001222222211118888100000000222222022222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0777777707777777077777770777777707777b770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07b7477707b7477707774777077747770777b7770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077b7bb7077b7bb7077b7bb7077b7bbb077b7bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0777b7770777b7770777b7770777b7770777b7770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0777c7770777c7770777c7770777c7770777c7770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077c7c77077c7c77077c7c77077c7c77077c7c770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777c77077c7c77077c7c77077c7c77077c7c770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000002020202020202020200000200020202020202020202020202020202020202020202020202020202000002020202000200020000000200020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202000002020202020202020002020000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3c3c3e3f811919191f1919191f19198b30303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
323b3a8c803030302d3030302d308a1530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1237121238301430300614063030301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b828382293000000b3030063030301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b831383852e2e2e083030308d2e2e2030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3183838229300630303030870630301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b83138229300b06301430060614301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2b8283830d2e0e06063030063030301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36352a2a33303006060b300a232e2e2030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
163030302c308930062c30302d30301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16300b302c303088060030303030301530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d2e08302c300030068e2e0c2e09061530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
163030302c00000a2e08302d3006061530303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d2e14302d00003006003030300a2e2730303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1630303030303014300030143030308f30303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2818181818181818181818181818188630303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818182730303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002d150000002c1502c1500000023150231502c150231502b1502b1502b1502b1502b1502b150181502b1502b150311502c1502c15025150211502c1502c1503a1503815036150331502a1500000000000
